<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cosaint na bhFocal — Co. Mayo Noun Game</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0;
      background:#0b0f16;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:grid;
      place-items:center;
      min-height:100vh;
      padding:14px;
    }
    .wrap{ width:min(980px,100%); }
    .hud{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-bottom:10px; color:#d7e2ff; font-size:14px;
    }
    .hud .left{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.12);
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }
    canvas{
      width:100%;
      height:auto;
      background: linear-gradient(#070a10, #0b0f16);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:14px;
      box-shadow:0 10px 40px rgba(0,0,0,0.55);
      touch-action: none;
    }
    .panel{
      margin-top:10px;
      color:#c9d6ff;
      font-size:13px;
      line-height:1.35;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:12px;
      padding:10px 12px;
    }
    .small{ opacity:0.92; }

    /* Touch controls */
    .controls{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .btn{
      user-select:none;
      -webkit-user-select:none;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.08);
      color:#eaf1ff;
      padding:14px 12px;
      font-size:16px;
      font-weight:650;
      text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.22);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.m { background: rgba(130,190,255,0.18); }
    .btn.f { background: rgba(255,150,220,0.16); }
    .btn.small { font-size:14px; font-weight:600; padding:12px 10px; opacity:1; }
    .btnRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .note{
      margin-top:8px;
      opacity:0.9;
      font-size:12px;
    }

    /* On desktop, keep buttons but make them smaller */
    @media (min-width: 860px){
      .controls{ grid-template-columns: 1fr 1fr 1fr 1fr; }
      .btnRow{ grid-template-columns: 1fr 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="hud">
      <div class="left">
        <div class="pill" style="font-size:16px; font-weight:700;">Cosaint na bhFocal</div>
        <div class="pill">Score: <b id="score">0</b></div>
        <div class="pill">Streak: <b id="streak">0</b></div>
        <div class="pill">Lives: <b id="lives">3</b></div>
        <div class="pill">Level: <b id="level">1</b></div>
        <div class="pill">Mode: <b id="mode">Practice</b></div>
      </div>
      <div class="pill">
        Keys: M/F shoot · P pause · R restart · H hints
      </div>
    </div>

    <canvas id="game" width="960" height="520" aria-label="Cosaint na bhFocal game canvas"></canvas>

    <!-- Touch controls (works on phones + tablets) -->
    <div class="controls" aria-label="Touch controls">
      <div class="btn m" id="btnM">Masculine (M)</div>
      <div class="btn f" id="btnF">Feminine (F)</div>
      <div class="btn small" id="btnP">Pause / Resume</div>
      <div class="btn small" id="btnH">Hints: On/Off</div>
    </div>
    <div class="btnRow">
      <div class="btn small" id="btnR">Restart</div>
      <div class="btn small" id="btnLeft">◀ Move</div>
      <div class="btn small" id="btnRight">Move ▶</div>
    </div>
    <div class="note small">
      Tip: you can also drag your finger left/right on the game area to move.
    </div>

    <div class="panel">
      <div class="small">
        Co. Mayo-themed nouns fall. Shoot with <b>Masculine</b> or <b>Feminine</b>.
        Wrong shot or missed word = lose a life.
      </div>
      <div class="small" style="margin-top:6px;">
        Hint phrases use a teaching heuristic: adjective after a <i>feminine</i> noun often lenites (e.g. <i>sráid mhór</i>)
        while after a <i>masculine</i> noun often doesn’t (e.g. <i>teach mór</i>).
      </div>
    </div>

  </div>

<script>
(() => {
  "use strict";

  // ============================================================
  //  Co. Mayo-themed Irish nouns (coast + countryside + community)
  // ============================================================
  const NOUNS = [
    // Coastal life
    { w: "bád", g: "m" },        // boat
    { w: "iasc", g: "m" },       // fish
    { w: "cladach", g: "m" },    // shore
    { w: "calafort", g: "m" },   // harbour
    { w: "tonn", g: "f" },       // wave
    { w: "taoide", g: "f" },     // tide
    { w: "farraige", g: "f" },   // sea
    { w: "trá", g: "f" },        // beach
    { w: "gaoth", g: "f" },      // wind
    { w: "báisteach", g: "f" },  // rain
    { w: "oíche", g: "f" },      // night

    // Countryside
    { w: "cnoc", g: "m" },       // hill
    { w: "páirc", g: "f" },      // field
    { w: "móin", g: "f" },       // turf/peat
    { w: "bó", g: "f" },         // cow
    { w: "capall", g: "m" },     // horse
    { w: "caora", g: "f" },      // sheep
    { w: "crann", g: "m" },      // tree
    { w: "loch", g: "m" },       // lake
    { w: "abhainn", g: "f" },    // river
    { w: "droichead", g: "m" },  // bridge
    { w: "bóthar", g: "m" },     // road
    { w: "slí", g: "f" },        // way/path

    // Home/community
    { w: "teach", g: "m" },      // house
    { w: "doras", g: "m" },      // door
    { w: "fuinneog", g: "f" },   // window
    { w: "sráid", g: "f" },      // street
    { w: "siopa", g: "m" },      // shop
    { w: "scoil", g: "f" },      // school
    { w: "séipéal", g: "m" },    // church
    { w: "cluiche", g: "m" },    // game/match
    { w: "ceol", g: "m" },       // music
    { w: "obair", g: "f" },      // work
    { w: "ceist", g: "f" },      // question
    { w: "páiste", g: "m" },     // child
    { w: "bean", g: "f" },       // woman
    { w: "fear", g: "m" },       // man
    { w: "baile", g: "m" },      // town
  ];

  // ---------- Canvas ----------
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d", { alpha: false });

  function fitCanvas(){
    const cssW = canvas.clientWidth;
    const ratio = window.devicePixelRatio || 1;
    canvas.width  = Math.round(cssW * ratio);
    canvas.height = Math.round((cssW * (520/960)) * ratio);
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0); // draw in CSS pixels
  }
  function W(){ return canvas.clientWidth; }
  function H(){ return canvas.clientHeight; }

  requestAnimationFrame(() => fitCanvas());
  window.addEventListener("resize", () => fitCanvas());

  // ---------- HUD ----------
  const scoreEl  = document.getElementById("score");
  const streakEl = document.getElementById("streak");
  const livesEl  = document.getElementById("lives");
  const levelEl  = document.getElementById("level");
  const modeEl   = document.getElementById("mode");

  // ---------- Game state ----------
  const state = {
    over: false,
    paused: false,
    score: 0,
    streak: 0,
    lives: 3,
    level: 1,
    time: 0,
    nextSpawn: 0,
    invaders: [],
    shots: [],
    message: { text: "", until: 0 },
    showHints: true,

    // gentle drift to animate background waves
    seaPhase: 0
  };

  const player = { x: 0, y: 0, w: 104, h: 18 };

  function updateHUD(){
    scoreEl.textContent  = String(state.score);
    streakEl.textContent = String(state.streak);
    livesEl.textContent  = String(state.lives);
    levelEl.textContent  = String(state.level);
    modeEl.textContent   = state.showHints ? "Practice" : "Test";
  }

  function positionPlayer(){
    player.x = W()/2 - player.w/2;
    player.y = H() - 46;
  }

  // ---------- Difficulty knobs ----------
  function spawnInterval(level){ return Math.max(0.55, 1.35 - level*0.10); }
  function invaderSpeed(level){ return 32 + level*6; }
  function shotSpeed(){ return 540; }

  // ---------- Helpers ----------
  function randChoice(arr){ return arr[Math.floor(Math.random() * arr.length)]; }
  function showMessage(text, seconds=1.2){
    state.message.text = text;
    state.message.until = state.time + seconds;
  }
  function resetGame(){
    state.over = false;
    state.paused = false;
    state.score = 0;
    state.streak = 0;
    state.lives = 3;
    state.level = 1;
    state.time = 0;
    state.nextSpawn = 0.7;
    state.invaders.length = 0;
    state.shots.length = 0;
    state.message = { text: "Tap Masculine/Feminine to shoot. Drag to move.", until: 2.8 };
    updateHUD();
    positionPlayer();
  }

  // ============================================================
  //  Hint engine (simplified)
  // ============================================================
  function lenite(word){
    if (!word) return word;
    const first = word[0].toLowerCase();
    const lenitable = new Set(["b","c","d","f","g","m","p","s","t"]);
    if (word.length >= 2 && word[1].toLowerCase() === "h") return word;
    if (lenitable.has(first)) return word[0] + "h" + word.slice(1);
    return word;
  }
  function adjectiveAfterNoun(adj, nounGender){
    return nounGender === "f" ? lenite(adj) : adj;
  }
  const ADJECTIVES = ["mór","beag","fuar","fliuch","garbh","ciúin"];
  function examplePhrase(noun, gender){
    const adj = randChoice(ADJECTIVES);
    return `${noun} ${adjectiveAfterNoun(adj, gender)}`;
  }

  // ---------- Entities ----------
  function spawnInvader(){
    const item = randChoice(NOUNS);
    const padding = 14;
    const x = padding + Math.random() * (W() - padding*2);
    state.invaders.push({
      word: item.w,
      g: item.g,
      x,
      y: -24,
      vy: invaderSpeed(state.level),
      r: 16,
      hit: false
    });
  }
  function fireShot(gender){
    if (state.over || state.paused) return;
    state.shots.push({
      g: gender,
      x: player.x + player.w/2,
      y: player.y,
      vy: -shotSpeed(),
      r: 6
    });
  }

  // ---------- Input: keyboard ----------
  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "p") state.paused = !state.paused;
    if (k === "r") resetGame();
    if (k === "h") { state.showHints = !state.showHints; updateHUD(); }
    if (k === "m") fireShot("m");
    if (k === "f") fireShot("f");
  });

  // ---------- Input: touch buttons ----------
  function bindTap(el, fn){
    const handler = (ev) => { ev.preventDefault(); fn(); };
    el.addEventListener("pointerdown", handler);
  }
  bindTap(document.getElementById("btnM"), () => fireShot("m"));
  bindTap(document.getElementById("btnF"), () => fireShot("f"));
  bindTap(document.getElementById("btnP"), () => { state.paused = !state.paused; });
  bindTap(document.getElementById("btnR"), () => resetGame());
  bindTap(document.getElementById("btnH"), () => { state.showHints = !state.showHints; updateHUD(); });

  // Optional move buttons (hold to move)
  let moveLeftHeld = false, moveRightHeld = false;
  const btnLeft = document.getElementById("btnLeft");
  const btnRight = document.getElementById("btnRight");

  function bindHold(el, setHeld){
    el.addEventListener("pointerdown", (e)=>{ e.preventDefault(); setHeld(true); });
    el.addEventListener("pointerup",   (e)=>{ e.preventDefault(); setHeld(false); });
    el.addEventListener("pointercancel",(e)=>{ e.preventDefault(); setHeld(false); });
    el.addEventListener("pointerleave",(e)=>{ e.preventDefault(); setHeld(false); });
  }
  bindHold(btnLeft,  (v)=> moveLeftHeld = v);
  bindHold(btnRight, (v)=> moveRightHeld = v);

  // Drag-to-move on canvas
  function pointerMove(clientX){
    const rect = canvas.getBoundingClientRect();
    const x = clientX - rect.left;
    player.x = Math.max(10, Math.min(W()-10-player.w, x - player.w/2));
  }
  canvas.addEventListener("pointerdown", (e)=>{ e.preventDefault(); pointerMove(e.clientX); canvas.setPointerCapture(e.pointerId); });
  canvas.addEventListener("pointermove", (e)=>{ if (e.buttons) pointerMove(e.clientX); });

  // ---------- Collision ----------
  function dist2(ax, ay, bx, by){
    const dx = ax - bx, dy = ay - by;
    return dx*dx + dy*dy;
  }

  function handleHit(inv, shot){
    inv.hit = true;
    const correct = (inv.g === shot.g);

    if (correct){
      state.streak += 1;
      const base = 10;
      const bonus = Math.min(30, state.streak);
      state.score += base + bonus;

      const gTxt = inv.g === "m" ? "masc" : "fem";
      showMessage(
        state.showHints
          ? `✓ ${inv.word} (${gTxt}) — e.g. “${examplePhrase(inv.word, inv.g)}”`
          : `✓ ${inv.word} (${gTxt})`,
        state.showHints ? 1.35 : 1.0
      );
    } else {
      state.streak = 0;
      state.score = Math.max(0, state.score - 12);
      state.lives -= 1;

      const gTxt = inv.g === "m" ? "masc" : "fem";
      showMessage(
        state.showHints
          ? `✗ ${inv.word} is ${gTxt} — e.g. “${examplePhrase(inv.word, inv.g)}”`
          : `✗ ${inv.word} is ${gTxt}`,
        state.showHints ? 1.55 : 1.25
      );
    }

    // Level up pacing
    const newLevel = 1 + Math.floor(state.score / 160);
    if (newLevel !== state.level){
      state.level = newLevel;
      showMessage(`Level ${state.level}!`, 1.0);
    }

    if (state.lives <= 0){
      state.over = true;
      showMessage("Game Over — tap Restart", 999);
    }

    updateHUD();
  }

  // ---------- Background: Co. Mayo vibe (sea, coastline, hills, lighthouse) ----------
  function drawMayoBackground(dt){
    state.seaPhase += dt * 0.9;

    // Sky gradient
    const skyTop = 0;
    const horizonY = H() * 0.52;

    // subtle sky
    ctx.save();
    const skyGrad = ctx.createLinearGradient(0, skyTop, 0, horizonY);
    skyGrad.addColorStop(0, "rgba(10,16,28,1)");
    skyGrad.addColorStop(1, "rgba(18,28,46,1)");
    ctx.fillStyle = skyGrad;
    ctx.fillRect(0, 0, W(), horizonY);

    // distant glow near horizon
    ctx.fillStyle = "rgba(120,160,255,0.08)";
    ctx.fillRect(0, horizonY - 30, W(), 60);

    // Sea gradient
    const seaGrad = ctx.createLinearGradient(0, horizonY, 0, H());
    seaGrad.addColorStop(0, "rgba(10,32,48,1)");
    seaGrad.addColorStop(1, "rgba(6,18,30,1)");
    ctx.fillStyle = seaGrad;
    ctx.fillRect(0, horizonY, W(), H()-horizonY);

    // Wave lines (animated)
    ctx.globalAlpha = 0.22;
    ctx.lineWidth = 1;
    ctx.strokeStyle = "rgba(170,210,255,1)";
    for (let i=0; i<10; i++){
      const y = horizonY + 18 + i*26;
      ctx.beginPath();
      const amp = 6 + i*0.6;
      for (let x=0; x<=W(); x+=18){
        const t = state.seaPhase + i*0.6;
        const yy = y + Math.sin((x/85) + t) * amp * 0.35;
        ctx.lineTo(x, yy);
      }
      ctx.stroke();
    }
    ctx.globalAlpha = 1;

    // Coastline silhouette (Achill-ish / cliffs)
    ctx.fillStyle = "rgba(8,12,16,0.92)";
    ctx.beginPath();
    ctx.moveTo(0, horizonY + 40);
    ctx.lineTo(W()*0.18, horizonY + 22);
    ctx.lineTo(W()*0.28, horizonY + 34);
    ctx.lineTo(W()*0.40, horizonY + 18);
    ctx.lineTo(W()*0.52, horizonY + 38);
    ctx.lineTo(W()*0.64, horizonY + 26);
    ctx.lineTo(W()*0.78, horizonY + 46);
    ctx.lineTo(W(), horizonY + 30);
    ctx.lineTo(W(), H());
    ctx.lineTo(0, H());
    ctx.closePath();
    ctx.fill();

    // Hills behind coastline
    ctx.fillStyle = "rgba(14,22,20,0.55)";
    ctx.beginPath();
    ctx.moveTo(0, horizonY);
    ctx.quadraticCurveTo(W()*0.18, horizonY-60, W()*0.36, horizonY-10);
    ctx.quadraticCurveTo(W()*0.54, horizonY+20, W()*0.70, horizonY-25);
    ctx.quadraticCurveTo(W()*0.86, horizonY-70, W(), horizonY-10);
    ctx.lineTo(W(), horizonY);
    ctx.closePath();
    ctx.fill();

    // Lighthouse silhouette (simple)
    const lx = W()*0.86, ly = horizonY + 26;
    ctx.fillStyle = "rgba(10,10,12,0.95)";
    ctx.beginPath();
    ctx.moveTo(lx-10, ly);
    ctx.lineTo(lx+10, ly);
    ctx.lineTo(lx+6, ly-52);
    ctx.lineTo(lx-6, ly-52);
    ctx.closePath();
    ctx.fill();
    // top box
    ctx.fillRect(lx-9, ly-58, 18, 8);
    // tiny light glow
    ctx.fillStyle = "rgba(255,245,210,0.12)";
    ctx.beginPath();
    ctx.arc(lx, ly-54, 18, 0, Math.PI*2);
    ctx.fill();

    ctx.restore();
  }

  // ---------- Drawing: entities ----------
  function roundRect(c, x, y, w, h, r){
    c.beginPath();
    c.moveTo(x+r, y);
    c.arcTo(x+w, y, x+w, y+h, r);
    c.arcTo(x+w, y+h, x, y+h, r);
    c.arcTo(x, y+h, x, y, r);
    c.arcTo(x, y, x+w, y, r);
    c.closePath();
  }

  function drawGround(){
    ctx.save();
    ctx.strokeStyle = "rgba(255,255,255,0.20)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, H()-20);
    ctx.lineTo(W(), H()-20);
    ctx.stroke();
    ctx.restore();
  }

  function drawPlayer(){
    ctx.save();
    ctx.translate(player.x, player.y);

    ctx.fillStyle = "rgba(255,255,255,0.16)";
    ctx.fillRect(0, 0, player.w, player.h);

    const pad = 10;
    const cannonW = (player.w - pad*3)/2;
    const cannonH = 12;

    ctx.fillStyle = "rgba(130,190,255,0.40)";
    ctx.fillRect(pad, -cannonH, cannonW, cannonH);

    ctx.fillStyle = "rgba(255,150,220,0.34)";
    ctx.fillRect(pad*2 + cannonW, -cannonH, cannonW, cannonH);

    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "rgba(210,235,255,0.95)";
    ctx.fillText("M", pad + cannonW/2, -cannonH/2);
    ctx.fillStyle = "rgba(255,220,245,0.95)";
    ctx.fillText("F", pad*2 + cannonW + cannonW/2, -cannonH/2);

    ctx.restore();
  }

  function drawInvader(inv){
    ctx.save();
    ctx.translate(inv.x, inv.y);

    ctx.beginPath();
    ctx.arc(0, 0, inv.r + 10, 0, Math.PI*2);
    ctx.fillStyle = inv.g === "m" ? "rgba(130,190,255,0.14)" : "rgba(255,150,220,0.12)";
    ctx.fill();
    ctx.lineWidth = 1;
    ctx.strokeStyle = inv.g === "m" ? "rgba(130,190,255,0.35)" : "rgba(255,150,220,0.32)";
    ctx.stroke();

    ctx.font = "16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "rgba(245,248,255,0.95)";
    ctx.fillText(inv.word, 0, 0);

    // tiny gender marker in practice mode
    if (state.showHints){
      ctx.font = "11px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      ctx.fillStyle = "rgba(245,248,255,0.55)";
      ctx.fillText(inv.g.toUpperCase(), 0, 22);
    }

    ctx.restore();
  }

  function drawShot(s){
    ctx.save();
    ctx.translate(s.x, s.y);
    ctx.beginPath();
    ctx.arc(0, 0, s.r, 0, Math.PI*2);
    ctx.fillStyle = s.g === "m" ? "rgba(130,190,255,0.95)" : "rgba(255,150,220,0.95)";
    ctx.fill();
    ctx.restore();
  }

  function drawMessage(){
    if (!state.message.text || state.time > state.message.until) return;
    const text = state.message.text;

    ctx.save();
    ctx.font = "16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    const x = W()/2;
    const y = 34;

    const metrics = ctx.measureText(text);
    const padX = 14, padY = 9;
    const boxW = metrics.width + padX*2;
    const boxH = 24 + padY*2;

    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.strokeStyle = "rgba(255,255,255,0.18)";
    roundRect(ctx, x - boxW/2, y - boxH/2, boxW, boxH, 10);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = "rgba(235,245,255,0.95)";
    ctx.fillText(text, x, y);
    ctx.restore();
  }

  // ---------- Main loop ----------
  let last = performance.now();

  function tick(now){
    const dt = Math.min(0.033, (now - last)/1000);
    last = now;

    // keep player placed if canvas size changes
    if (player.y === 0) positionPlayer();
    else player.y = H() - 46;

    // move buttons (hold)
    const moveSpeed = 340; // px/sec
    if (!state.over && !state.paused){
      if (moveLeftHeld)  player.x -= moveSpeed * dt;
      if (moveRightHeld) player.x += moveSpeed * dt;
      player.x = Math.max(10, Math.min(W()-10-player.w, player.x));
    }

    if (!state.over && !state.paused){
      state.time += dt;

      if (state.time >= state.nextSpawn){
        spawnInvader();
        state.nextSpawn = state.time + spawnInterval(state.level) * (0.85 + Math.random()*0.35);
      }

      for (const inv of state.invaders) inv.y += inv.vy * dt;
      for (const s of state.shots) s.y += s.vy * dt;

      // collisions
      for (const inv of state.invaders){
        if (inv.hit) continue;
        for (const s of state.shots){
          if (s.y < -30) continue;
          const rr = (inv.r + 10 + s.r);
          if (dist2(inv.x, inv.y, s.x, s.y) <= rr*rr){
            s.y = -9999;
            handleHit(inv, s);
            break;
          }
        }
      }

      // invaders reaching ground
      for (const inv of state.invaders){
        if (inv.hit) continue;
        if (inv.y >= H() - 24){
          inv.hit = true;
          state.streak = 0;
          state.lives -= 1;
          showMessage(`Missed: ${inv.word}`, 1.0);

          if (state.lives <= 0){
            state.over = true;
            showMessage("Game Over — tap Restart", 999);
          }
          updateHUD();
        }
      }

      // cleanup
      state.invaders = state.invaders.filter(inv => inv.y < H() + 60 && !inv.hit);
      state.shots = state.shots.filter(s => s.y > -60 && s.y < H() + 60);
    }

    // draw
    ctx.clearRect(0, 0, W(), H());
    drawMayoBackground(dt);
    drawGround();

    for (const inv of state.invaders) drawInvader(inv);
    for (const s of state.shots) drawShot(s);
    drawPlayer();

    if (state.paused && !state.over){
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.35)";
      ctx.fillRect(0, 0, W(), H());
      ctx.font = "22px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";
      ctx.fillStyle = "rgba(245,248,255,0.95)";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("Paused", W()/2, H()/2);
      ctx.restore();
    }

    if (state.over){
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.45)";
      ctx.fillRect(0, 0, W(), H());
      ctx.font = "28px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";
      ctx.fillStyle = "rgba(245,248,255,0.95)";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("Game Over", W()/2, H()/2 - 18);
      ctx.font = "16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";
      ctx.fillText("Tap Restart", W()/2, H()/2 + 18);
      ctx.restore();
    }

    drawMessage();
    requestAnimationFrame(tick);
  }

  resetGame();
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
